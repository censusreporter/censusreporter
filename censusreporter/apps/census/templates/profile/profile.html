{% extends 'profile/_base_profile.html' %}{% load humanize %}

{% block head_title %}{% firstof geography.this.full_name geography.this.short_name %} - {{ block.super }}{% endblock %}

{% block head_css_extra %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
<![endif]-->
<link href='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css' rel='stylesheet' />
  <!--[if lte IE 8]>
    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.ie.css' rel='stylesheet' >
  <![endif]-->
{% endblock %}

{% block head_javascript_extra %}
{#}<script src="http://d3js.org/d3.v3.min.js"></script>{#}
<script src="{{ STATIC_URL }}js/vendor/d3.v3.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
<script src='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js'></script>
{% endblock %}

{% block body_id %}profile{% endblock %}

{% block header_content %}
<div id="cover-map" class="clearfix">
    <div id="cover-profile" class="wrapper">
        <article class="clearfix column-half">
            <header class="column-full">
                <h1 class="title">{% firstof geography.this.full_name geography.this.short_name %}</h1>
                <p class="caption">Data: {{ geography.census_release }} unless noted</p>
            </header>
            <div class="column-half">
                <div class="stat">
                    <span class="primary">
                        <span class="value">{{ geography.this.total_population|intcomma }}</span>
                        <span class="name">Population</span>
                    </span>
                </div>
            </div>
            {% if geo_metadata.square_miles %}
            <div class="column-half">
                <div class="stat">
                    <span class="secondary">
                        <span class="value">{{ geo_metadata.square_miles|floatformat|intcomma }}</span>
                        <span class="name"> square miles</span>
                    </span>
                    <span class="secondary">
                        <span class="value">{{ geo_metadata.population_density|floatformat|intcomma }}</span>
                        <span class="name"> people per square mile</span>
                    </span>
                </div>
            </div>
            {% endif %}
            {% comment %}
            <div class="column-full">
                <p>This is some short, generated text that uses the facts and figures below to provide some narrative about the place being profiled.</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla sagittis vehicula euismod. In erat quam, dictum eu leo non, euismod pretium diam. Maecenas rutrum dolor at diam placerat aliquam. Aenean rhoncus sapien ac venenatis euismod. Nam id ligula facilisis, placerat erat at, congue diam.</p>
            </div>
            {% endcomment %}
        </article>
    </div>

    <div id="slippy-map"></div>
</div>

{% endblock %}

{% block content %}
{#}<p class="explain">Indexes show data as a percentage of state and national values, highlighting values that diverge by at least 20%.</p>{#}

{% comment %}
<article id="test" class="clearfix">
    <header class="section-contents">
        <h1>Table B02001</h1>
    </header>
    <div class="section-container">

        <section class="clearfix stat-row">
            <aside></aside>
            <div class="column-golden-wide">
                <h2>Race</h2>
                <table id="data-table" class="full-width">
                    <thead>
                        <tr>
                            <th class="name">Column</th>
                            <th class="value">Percentage</th>
                            <th class="value">Number</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="odd">
                            <td class="name indent-0">Total:</td>
                            <td class="value">
                                <span class="percentage">100%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">313,914,040</span>
                            </td>
                        </tr>

                        <tr class="even">
                            <td class="name indent-1">White alone</td>
                            <td class="value">
                                <span class="percentage">73.9%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">231,992,377</span>
                            </td>
                        </tr>

                        <tr class="odd">
                            <td class="name indent-1">Black or African American alone</td>
                            <td class="value">
                                <span class="percentage">12.6%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">39,623,138</span>
                            </td>
                        </tr>

                        <tr class="even">
                            <td class="name indent-1">American Indian and Alaska Native alone</td>

                            <td class="value">
                                <span class="percentage">0.8%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">2,563,505</span>
                            </td>
                        </tr>

                        <tr class="odd">
                            <td class="name indent-1">Asian alone</td>
                            <td class="value">
                                <span class="percentage">5%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">15,555,530</span>
                            </td>
                        </tr>

                        <tr class="even">
                            <td class="name indent-1">Native Hawaiian and Other Pacific Islander alone</td>
                            <td class="value">
                                <span class="percentage">0.2%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">543,198</span>
                            </td>
                        </tr>

                        <tr class="odd">
                            <td class="name indent-1">Some other race alone</td>
                            <td class="value">
                                <span class="percentage">4.6%</span>
                            </td>
                            <td class="value">
                                <span class="raw-number">14,562,678</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="column-golden-narrow">
                <h2>Create a comparison with this table</h2>

                <div class="option-group">
                    <h2 class="option-header">Compare Spokane against&hellip;</h3>
                    <ul class="option-list">
                        <li><a href="">Other cities in Washington</a></li>
                        <li><a href="">Choose your own list of places to compare</a></li>
                    </ul>
                </div>
                
                <div class="option-group">
                    <h2 class="option-header">Divide Spokane by&hellip;</h2>
                    <ul class="option-list">
                        <li><a href="">Census Tracts</a></li>
                        <li><a href="">Block Groups</a></li>
                        <li><a href="">ZIP Codes</a></li>
                    </ul>
                </div>
            </div>
            {#}<div class="column-half" id="chart-column-testdata-marital_status_grouped-widowed" data-stat-type="scaled-percentage" data-chart-title="Marital status"></div>{#}
        </section>

    </div>
</article>
{% endcomment %}

<article id="demographics" class="clearfix">
    <header class="section-contents">
        <h1>Demographics</h1>
    </header>
    <div class="section-container">

        <section class="clearfix stat-row" id="age">
            <h2 class="column-header">Age</h2>
            <aside>
                {#}TODO: Figure out a better way of providing links to comparison pages{#}
                {% if sumlev in "040,050" %}
                <h3>Compare</h3>
                <p><a href="{% url 'geography_comparison_detail' state_geoid sumlev 'map' %}">Counties by age group</a></p>
                {% endif %}
            </aside>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=demographics.age.median_age stat_type='number' %}
            </div>
            <div class="column-half" id="chart-histogram-demographics-age-population_by_age-total" data-stat-type="scaled-percentage" data-chart-title="Population by age range"></div>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=demographics.age.percent_under_18 stat_type='percentage' stat_class='secondary' %}
                {% include 'profile/_blocks/_stat_list.html' with stat=demographics.age.percent_over_65 stat_type='percentage' stat_class='secondary' %}
            </div>
        </section>

        <section class="clearfix stat-row" id="sex-race">
            <aside></aside>
            <div class="column-third">
                <h2 class="column-header">Sex</h2>
                <div id="chart-pie-demographics-sex" data-stat-type="percentage" data-initial-sort="-value"></div>
            </div>
            <div class="column-two-thirds">
                <h2 class="column-header">Race &amp; Ethnicity</h2>
                <div id="chart-column-demographics-race" data-stat-type="scaled-percentage"></div>
            </div>
        </section>

    </div>
</article>


<article id="economics" class="clearfix">
    <header class="section-contents">
        <h1>Economics</h1>
    </header>
    <div class="section-container">

        <section class="clearfix stat-row" id="income">
            <h2>Income</h2>
            <aside>
            </aside>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=economics.income.per_capita_income_in_the_last_12_months stat_type='dollar' %}
            </div>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=economics.income.median_household_income stat_type='dollar' %}
            </div>
            <div class="column-half" id="chart-histogram-economics-income-household_distribution" data-chart-title="Household income" data-stat-type="scaled-percentage"></div>
        </section>

        <section class="clearfix stat-row" id="poverty-status">
            <h2>Poverty</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=economics.poverty.percent_below_poverty_line stat_type='percentage' %}
            </div>
            <div class="column-third" id="chart-pie-economics-poverty-children" data-chart-title="Children (Under 18)" data-stat-type="percentage"></div>
            <div class="column-third" id="chart-pie-economics-poverty-seniors" data-chart-title="Seniors (65 and over)" data-stat-type="percentage"></div>
        </section>

        <section class="clearfix stat-row" id="commute">
            <h2>Transportation to work</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=economics.employment.mean_travel_time stat_type='time' stat_suffix='minutes' %}
            </div>
            <div class="column-two-thirds" id="chart-histogram-economics-employment-transportation_distribution" data-chart-title="Means of transportation to work" data-stat-type="scaled-percentage"></div>
        </section>

    </div>
</article>


<article id="families" class="clearfix">
    <header class="section-contents">
        <h1>Families</h1>
    </header>
    <div class="section-container">

        <section class="clearfix stat-row" id="households">
            <h2>Households</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=families.households.number_of_households stat_type='number' %}
            </div>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=families.households.persons_per_household stat_type='number' %}
            </div>
            <div class="column-third" id="chart-pie-families-households-distribution" data-stat-type="percentage" data-initial-sort="-value" data-chart-title="Population by household type"></div>
        </section>

        <section class="clearfix stat-row" id="marital-status">
            <h2>Marital status</h2>
            <aside>
            </aside>
            <div class="column-third" id="chart-pie-families-marital_status" data-stat-type="percentage"></div>
            <div class="column-two-thirds" id="chart-grouped_column-families-marital_status_grouped" data-stat-type="scaled-percentage" data-chart-title="Marital status, by sex"></div>
        </section>

        <section class="clearfix stat-row" id="birth-rate">
            <h2>Birth rate</h2>
            <aside></aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=families.birth_rate.total stat_type='number' %}
            </div>
            <div class="column-two-thirds">
                <div id="chart-column-families-birth_rate-by_age" data-stat-type="number" data-chart-title="Birth rate by age, per 1,000 women"></div>
            </div>
        </section>

    </div>
</article>


<article id="housing" class="clearfix">
    <header class="section-contents">
        <h1>Housing</h1>
    </header>
    <div class="section-container">

        <section class="clearfix stat-row" id="housing-occupancy">
            <h2>Units &amp; Occupancy</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=housing.units.number stat_type='number' %}
            </div>
            <div class="column-third" id="chart-pie-housing-units-occupancy_distribution" data-stat-type="percentage" data-chart-title="Occupied vs. Vacant"></div>
            <div class="column-third" id="chart-pie-housing-units-structure_distribution" data-stat-type="percentage" data-chart-title="Types of structure"></div>
        </section>
        <section class="clearfix stat-row">
            <div class="column-third" id="chart-pie-housing-ownership-distribution" data-stat-type="percentage" data-initial-sort="-value" data-chart-title="Ownership of occupied units"></div>
            <div class="column-two-thirds" id="chart-histogram-housing-length_of_tenure" data-stat-type="scaled-percentage" data-chart-title="Year moved in, by percentage of population"></div>
        </section>

        <section class="clearfix stat-row" id="housing-value">
            <h2>Value</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=housing.ownership.median_value stat_type='dollar' %}
            </div>
            <div class="column-two-thirds" id="chart-histogram-housing-ownership-value_distribution" data-chart-title="Value of owner-occupied housing units" data-stat-type="scaled-percentage"></div>
        </section>

        <section class="clearfix stat-row" id="geographical-mobility">
            <h2>Geographical mobility</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=housing.migration.moved_since_previous_year stat_type='percentage' %}
            </div>
            <div class="column-two-thirds" id="chart-histogram-housing-migration_distribution" data-stat-type="scaled-percentage" data-chart-title="Population migration since previous year"></div>
        </section>

    </div>
</article>


<article id="social" class="clearfix">
    <header class="section-contents">
        <h1>Social</h1>
    </header>
    <div class="section-container">

        <section class="clearfix stat-row" id="educational-attainment">
            <h2>Educational attainment</h2>
            <aside>
            </aside>
            <div class="column-half">
                <div class="column-half">
                    {% include 'profile/_blocks/_stat_list.html' with stat=social.educational_attainment.percent_high_school_grad_or_higher stat_type='percentage' %}
                </div>
                <div class="column-half">
                    {% include 'profile/_blocks/_stat_list.html' with stat=social.educational_attainment.percent_bachelor_degree_or_higher stat_type='percentage' %}
                </div>
            </div>
            <div class="column-half" id="chart-histogram-social-educational_attainment_distribution" data-stat-type="scaled-percentage" data-chart-title="Population by minimum level of education"></div>
        </section>

        <section class="clearfix stat-row" id="language">
            <h2>Language</h2>
            <aside>
            </aside>
            <div class="column-third">
                {% include 'profile/_blocks/_stat_list.html' with stat=social.language.percent_non_english_at_home stat_type='percentage' %}
            </div>
            <div class="column-third" id="chart-pie-social-language-children" data-stat-type="percentage" data-initial-sort="-value" data-chart-title="Language at home, children 5-17"></div>
            <div class="column-third" id="chart-pie-social-language-adults" data-stat-type="percentage" data-initial-sort="-value" data-chart-title="Language at home, adults 18+"></div>
        </section>

        <section class="clearfix stat-row" id="place-of-birth">
            <h2>Place of birth</h2>
            <aside></aside>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=social.place_of_birth.percent_foreign_born stat_type='percentage' %}
            </div>
            <div class="column-three-quarters" id="chart-column-social-place_of_birth-distribution" data-chart-title="Place of birth for foreign-born population" data-stat-type="scaled-percentage"></div>
        </section>

        <section class="clearfix stat-row" id="veteran-status">
            <h2>Veteran status</h2>
            <aside>
            </aside>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=social.veterans.percentage stat_type='percentage' %}
            </div>
            <div class="column-half" id="chart-column-social-veterans-wartime_service" data-stat-type="number" data-chart-title="Veterans by wartime service" data-qualifier="Veterans who served during wartime only"></div>
            <div class="column-quarter">
                {% include 'profile/_blocks/_stat_list.html' with stat=social.veterans.number stat_type='number' stat_class='secondary' %}
                {% include 'profile/_blocks/_stat_list.html' with stat=social.veterans.sex.male stat_type='number' stat_class='secondary' %}
                {% include 'profile/_blocks/_stat_list.html' with stat=social.veterans.sex.female stat_type='number' stat_class='secondary' %}
            </div>
        </section>

    </div>
</article>
{% endblock %}

{% block body_javascript_extra %}
<script src="{{ STATIC_URL }}js/charts.js"></script>
<script type="text/javascript">
var allowMapDrag = (browserWidth > 480) ? true : false;

// draw a geom
{% if geo_metadata.geom %}
var map = L.mapbox.map('slippy-map', 'censusreporter.map-j9q076fv', {
    scrollWheelZoom: false,
    zoomControl: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    dragging: allowMapDrag,
    touchZoom: allowMapDrag
});

if (allowMapDrag) {
    map.addControl(new L.Control.Zoom({
        position: 'topright'
    }));
}

var featureData = JSON.parse('{% autoescape off %}{{ geo_metadata.geom }}{% endautoescape %}'),
    featureLayer = L.geoJson(featureData, {
        style: {
            "fillColor": "#66c2a5",
            "color": "#777",
            "weight": 2,
            "clickable": false
        }
    });
map.addLayer(featureLayer);
var objBounds = featureLayer.getBounds();

if (browserWidth > 768) {
    var z;
    for(z = 16; z > 2; z--) {
        var swPix = map.project(objBounds.getSouthWest(), z),
            nePix = map.project(objBounds.getNorthEast(), z),
            pixWidth = Math.abs(nePix.x - swPix.x),
            pixHeight = Math.abs(nePix.y - swPix.y);
        if (pixWidth <  500 && pixHeight < 400) {
            break;
        }
    }

    map.setView(featureLayer.getBounds().getCenter(), z);
    map.panBy([-270, 0], {animate: false});
} else {
    map.fitBounds(featureLayer.getBounds());
}
{% endif %}

var Charts = {},
    chartContainers = $('[id^=chart-]'),
    defaultDataRelease = '{{ geography.census_release }}',
    profileData = {{ profile_data_json }};

var gracefulType = function(chartType) {
    // convert certain chart types to more readable versions at narrow widths
    if (browserWidth <= 640) {
        if (chartType == 'column' || chartType == 'histogram') {
            return 'bar'
        } else if (chartType == 'grouped_column') {
            return 'grouped_bar'
        }
    }
    return chartType
}

$.each(chartContainers, function(i) {
    var chartID = $(this).prop('id'),
        chartDataID = chartID.replace('chart-','').replace('alt-','').split('-'),
        chartType = gracefulType(chartDataID[0]),
        chartData = profileData[chartDataID[1]],
        chartChartTitle = $(this).data('chart-title'),
        chartChartShowYAxis = $(this).data('chart-show-y-axis'),
        chartInitialSort = $(this).data('initial-sort'),
        chartStatType = $(this).data('stat-type'),
        chartQualifier = $(this).data('qualifier') || null;
        
    // allow arbitrary nesting in API data structure
    var drilldown = chartDataID.length - 1;
    if (drilldown >= 2) {
        for (var i = 2; i <= drilldown; i++) {
            chartData = chartData[chartDataID[i]]
        }
    }
    
    // determine whether data point is from anything other
    // than the primary ACS release for this page
    for (var key in chartData) if (chartData.hasOwnProperty(key)) break;
    var thisRelease = chartData[key]['acs_release'],
        noteRelease = (thisRelease != defaultDataRelease) ? thisRelease + ' data' : null,
        chartQualifier = (!!noteRelease) ? Array(chartQualifier, noteRelease).filter(function(n) { return n }).join('; ') : chartQualifier;

    Charts[i] = Chart({
        chartContainer: chartID,
        chartType: chartType,
        chartHeight: 160,
        chartData: chartData,
        chartQualifier: chartQualifier,
        chartChartTitle: chartChartTitle,
        chartInitialSort: chartInitialSort,
        chartStatType: chartStatType
    });
});
</script>
{% endblock %}